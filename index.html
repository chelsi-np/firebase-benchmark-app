<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Firebase Benchmark - Firestore vs Realtime DB</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ‚úÖ Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
    <!-- <div class="container py-4">
        <h1 class="mb-4 text-center">üî• Firebase Benchmark Tool</h1>

        <div class="row g-3 mb-3">
            <div class="col-md-6">
                <div class="card p-3">
                    <h4>Firestore Tests</h4>
                    <button id="fs-single-read" class="btn btn-primary mt-2 w-100">Single Read</button>
                    <button id="fs-multi-read" class="btn btn-secondary mt-2 w-100">Multiple Reads (5)</button>
                    <button id="fs-write" class="btn btn-success mt-2 w-100">Write</button>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card p-3">
                    <h4>Realtime DB Tests</h4>
                    <button id="rtdb-single-read" class="btn btn-primary mt-2 w-100">Single Read</button>
                    <button id="rtdb-multi-read" class="btn btn-secondary mt-2 w-100">Multiple Reads (5)</button>
                    <button id="rtdb-write" class="btn btn-success mt-2 w-100">Write</button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h5>üìä Benchmark Results</h5>
                <table class="table table-bordered table-striped mt-2" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Test</th>
                            <th>DB Type</th>
                            <th>Duration (ms)</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-body">
                <h5>üìù Log Records</h5>
                <pre id="log" class="bg-dark text-light p-2 rounded" style="height: 200px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div> -->

    <!-- 
    <script type="module">
        const logEl = document.getElementById('log');
        const resultsTable = document.querySelector('#resultsTable tbody');

        function log(msg) {
            const time = new Date().toLocaleTimeString();
            logEl.textContent += `[${time}] ${msg}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

        // Add connection state monitoring
        import { onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCjxPu5oeCU7N_kby60HQSG6bn2iW8YVPo",
            authDomain: "fir-benchmark-test.firebaseapp.com",
            databaseURL: "https://fir-benchmark-test-default-rtdb.asia-southeast1.firebasedatabase.app/", // Important for Realtime DB
            projectId: "fir-benchmark-test", // For Firestore
            storageBucket: "fir-benchmark-test.firebasestorage.app",
            messagingSenderId: "219037660705",
            appId: "1:219037660705:web:f37ac979f0f9f740ee5560"
        };

        // ‚úÖ Initialize Firebase
        log("Initializing Firebase app...");
        const app = initializeApp(firebaseConfig);
        const firestore = getFirestore(app);
        const realtimeDB = getDatabase(app);
        log("Firebase initialized successfully.");


        // Test Firestore connection
        async function testFirestoreConnection() {
            log("Attempting Firestore connection");
            try {
                const docRef = doc(firestore, '_test_connection', 'test');
                await setDoc(docRef, { timestamp: new Date() });
                log("Firestore write successful");

                const snapshot = await getDoc(docRef);
                log("Firestore read successful");
            } catch (error) {
                log("Firestore error: " + error.message);
                log("Error code: " + error.code);
            }
        }

        // Test Realtime Database connection
        async function testRealtimeDBConnection() {
            log("Attempting Realtime DB connection");
            try {
                const testRef = ref(realtimeDB, '_test_connection');
                await set(testRef, { timestamp: new Date().toISOString() });
                log("Realtime DB write successful");

                const snapshot = await get(testRef);
                log("Realtime DB read successful");
            } catch (error) {
                log("Realtime DB error: " + error.message);
            }
        }

        // Run tests
        testFirestoreConnection();
        testRealtimeDBConnection();

        function recordResult(test, dbType, duration) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${test}</td>
                <td>${dbType}</td>
                <td>${duration.toFixed(2)}</td>
                <td>${new Date().toLocaleTimeString()}</td>
            `;
            resultsTable.prepend(row);
        }

        // ------------------------
        // Firestore Tests Only
        // ------------------------

        // Single Read
        document.getElementById('fs-single-read').onclick = async () => {
            log('Running Firestore Single Read test...');
            const s0 = performance.now();
            const snap = await getDoc(doc(firestore, 'test', 'data1'));
            const s1 = performance.now();
            log(`Firestore single read: ${JSON.stringify(snap.data())}`);
            recordResult('Single Read', 'Firestore', s1 - s0);
            log('Single Read test completed.');
        };

        // Multiple Read
        document.getElementById('fs-multi-read').onclick = async () => {
            log('Running Firestore Multiple Read test...');
            const s0 = performance.now();
            for (let i = 1; i <= 5; i++) {
                await getDoc(doc(firestore, 'test', `data${i}`));
            }
            const s1 = performance.now();
            log(`Firestore 5 reads completed`);
            recordResult('Multiple Reads (5)', 'Firestore', s1 - s0);
            log('Multiple Read test completed.');
        };

        // Write
        document.getElementById('fs-write').onclick = async () => {
            log('Running Firestore Write test...');
            const id2 = `test_${Date.now()}`;
            const s0 = performance.now();
            await setDoc(doc(firestore, 'benchmark', id2), { time: Date.now() });
            const s1 = performance.now();
            log(`Firestore write completed`);
            recordResult('Write', 'Firestore', s1 - s0);
            log('Write test completed.');
        };

        // ------------------------
        // Realtime DB Tests Only
        // ------------------------

        // Single Read
        document.getElementById('rtdb-single-read').onclick = async () => {
            const t0 = performance.now();
            const snapshot = await get(ref(realtimeDB, 'test/data1'));
            const t1 = performance.now();
            log(`Realtime DB single read: ${JSON.stringify(snapshot.val())}`);
            recordResult('Single Read', 'Realtime DB', t1 - t0);
        };

        // Multiple Reads
        document.getElementById('rtdb-multi-read').onclick = async () => {
            const t0 = performance.now();
            for (let i = 1; i <= 5; i++) {
                await get(ref(realtimeDB, `test/data${i}`));
            }
            const t1 = performance.now();
            log(`Realtime DB 5 reads completed`);
            recordResult('Multiple Reads (5)', 'Realtime DB', t1 - t0);
        };

        // Write
        document.getElementById('rtdb-write').onclick = async () => {
            const id = `test_${Date.now()}`;
            const t0 = performance.now();
            await set(ref(realtimeDB, `benchmark/${id}`), { time: Date.now() });
            const t1 = performance.now();
            log(`Realtime DB write completed`);
            recordResult('Write', 'Realtime DB', t1 - t0);
        };
    </script> -->

    <!-- TEST LOCKED -->
    <div class="box">
        <h3>1. Sign In</h3>
        <button onclick="signIn()">Sign In Anonymously</button>
        <p id="userStatus">Not signed in</p>
    </div>

    <div class="box">
        <h3>2. Save Data</h3>
        <input type="text" id="nameInput" placeholder="Your name">
        <input type="text" id="messageInput" placeholder="Your message">
        <button onclick="saveData()">Save to Database</button>
    </div>

    <div class="box">
        <h3>3. Load Data</h3>
        <button onclick="loadData()">Load My Data</button>
        <div id="dataDisplay"></div>
    </div>

    <div class="box">
        <h3>4. What's Happening?</h3>
        <div id="log"></div>
    </div>

    <!-- Firebase SDK -->
    <!-- Note that the file name must be the same as the JS file you are going to save! -->
    <script type="module" src="/sample_for_students/firebase.js"></script>


    <!-- Bootstrap JS Bundle (only once!) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>